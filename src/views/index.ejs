<%- include('partials/header') %>

<% if (success_msg) { %>
    <div class="alert alert-success alert-auto hero-alert" role="alert" data-auto-dismiss="6000">
        <i class="bi bi-check-circle-fill me-2"></i><%= success_msg %>
    </div>
<% } else if (error_msg) { %>
    <div class="alert alert-danger alert-auto hero-alert" role="alert" data-auto-dismiss="6000">
        <i class="bi bi-exclamation-triangle-fill me-2"></i><%= error_msg %>
    </div>
<% } %>

<%
    const sanitizedFeatured = Array.isArray(featuredProducts) ? featuredProducts : [];
    const sanitizedPromotions = Array.isArray(promotionProducts) ? promotionProducts : [];
    const sanitizedRecommended = Array.isArray(recommendedProducts) ? recommendedProducts : [];
    const sanitizedCatalog = Array.isArray(catalogProducts) ? catalogProducts : [];
    const heroSpotlights = sanitizedFeatured.slice(0, 2);
    const recommendationTags = Array.from(
        new Set(
            sanitizedRecommended
                .map((product) => (product && (product.categoryLabel || product.category)) || null)
                .filter(Boolean)
        )
    ).slice(0, 4);
    const catalogCategories = Array.from(
        new Set(
            sanitizedCatalog
                .map((product) => (product && (product.categoryLabel || product.category)) || null)
                .filter(Boolean)
        )
    );
%>

<section class="store-hero" id="inicio">
    <div class="container-xl">
        <div class="store-hero-inner">
            <div class="store-hero-content">
                <span class="store-chip store-chip-light">
                    <i class="bi bi-lightning-charge-fill me-2"></i>Festival Upgrade Tech
                </span>
                <h1 class="store-hero-title">Potência máxima para o seu setup profissional e gamer</h1>
                <p class="store-hero-subtitle">
                    Inspirado na experiência Kabum, criamos uma vitrine agressiva com ofertas exclusivas em hardware,
                    periféricos e soluções premium. Monte o combo perfeito com frete rápido e benefícios Kabum+.
                </p>
                <div class="store-hero-actions">
                    <a class="btn btn-store" href="#promocoes">Ver ofertas do dia</a>
                    <a class="btn btn-store-secondary" href="#catalogo">Catálogo completo</a>
                </div>
                <div class="store-hero-benefits">
                    <div class="benefit-item">
                        <i class="bi bi-truck"></i>
                        <div>
                            <strong>Frete Turbo</strong>
                            <span>Entrega em até 24h para capitais selecionadas</span>
                        </div>
                    </div>
                    <div class="benefit-item">
                        <i class="bi bi-shield-check"></i>
                        <div>
                            <strong>Garantia estendida</strong>
                            <span>Planos Kabum Pro com suporte prioritário</span>
                        </div>
                    </div>
                    <div class="benefit-item">
                        <i class="bi bi-graph-up"></i>
                        <div>
                            <strong>Kabum+</strong>
                            <span>Cashback progressivo e ofertas antecipadas</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="store-hero-showcase">
                <% if (heroSpotlights.length) { %>
                    <div class="store-hero-spotlights">
                        <% heroSpotlights.forEach((product, index) => { %>
                            <article class="spotlight-card <%= index === 0 ? 'spotlight-card-main' : '' %>">
                                <% if (product.tag) { %>
                                    <span class="product-chip chip-<%= product.accent %>"><%= product.tag %></span>
                                <% } %>
                                <h3><%= product.name %></h3>
                                <p><%= product.description %></p>
                                <div class="spotlight-pricing">
                                    <% if (product.originalPriceLabel) { %>
                                        <span class="price-old"><%= product.originalPriceLabel %></span>
                                    <% } %>
                                    <span class="price-current"><%= product.priceLabel %></span>
                                    <% if (product.installmentLabel) { %>
                                        <span class="price-installments"><%= product.installmentLabel %></span>
                                    <% } %>
                                </div>
                                <div class="spotlight-meta">
                                    <% if (product.shipping) { %>
                                        <span><i class="bi bi-truck"></i><%= product.shipping %></span>
                                    <% } %>
                                    <% if (product.deliveryEstimate) { %>
                                        <span><i class="bi bi-clock-history"></i><%= product.deliveryEstimate %></span>
                                    <% } %>
                                </div>
                            </article>
                        <% }) %>
                    </div>
                <% } %>
                <div class="store-hero-rating">
                    <div>
                        <strong>4.9/5</strong>
                        <span>+18k avaliações verificadas</span>
                    </div>
                    <div>
                        <strong>96%</strong>
                        <span>Clientes recomendam a experiência Kabum</span>
                    </div>
                    <div>
                        <strong>12x</strong>
                        <span>Parcelamento sem juros no Kabum Card</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="store-section" id="destaques">
    <div class="container-xl">
        <div class="section-heading">
            <div>
                <span class="store-chip"><i class="bi bi-stars me-2"></i>Produtos em destaque</span>
                <h2>Os queridinhos da comunidade Kabum</h2>
                <p>Seleção curada com os lançamentos mais desejados e configurações extremas para subir o nível do seu setup.</p>
            </div>
            <div class="section-cta">
                <a class="btn btn-store-secondary" href="#catalogo">Ver todos</a>
            </div>
        </div>
        <% if (sanitizedFeatured.length) { %>
            <div class="product-highlight-grid">
                <% sanitizedFeatured.forEach((product, index) => { %>
                    <article class="product-card <%= index === 0 ? 'product-card-main' : '' %>">
                        <div class="product-card-header">
                            <% if (product.tag) { %>
                                <span class="product-chip chip-<%= product.accent %>"><%= product.tag %></span>
                            <% } %>
                            <span class="product-rating" aria-label="Avaliação média de <%= product.rating %>">
                                <i class="bi bi-star-fill"></i>
                                <strong><%= product.rating.toFixed(1) %></strong>
                                <small>(<%= product.reviews %>)</small>
                            </span>
                        </div>
                        <div class="product-card-body">
                            <h3 class="product-name"><%= product.name %></h3>
                            <p class="product-description"><%= product.description %></p>
                            <% if (product.features && product.features.length) { %>
                                <ul class="product-features">
                                    <% product.features.slice(0, 3).forEach((feature) => { %>
                                        <li><i class="bi bi-check-circle-fill"></i><span><%= feature %></span></li>
                                    <% }) %>
                                </ul>
                            <% } %>
                        </div>
                        <div class="product-card-footer">
                            <div>
                                <% if (product.originalPriceLabel) { %>
                                    <span class="price-old"><%= product.originalPriceLabel %></span>
                                <% } %>
                                <span class="price-current"><%= product.priceLabel %></span>
                                <% if (product.installmentLabel) { %>
                                    <span class="price-installments"><%= product.installmentLabel %></span>
                                <% } %>
                            </div>
                            <div class="product-meta">
                                <% if (product.shipping) { %>
                                    <span><i class="bi bi-truck"></i><%= product.shipping %></span>
                                <% } %>
                                <% if (product.availability) { %>
                                    <span><i class="bi bi-box-seam"></i><%= product.availability %></span>
                                <% } %>
                            </div>
                            <div class="product-actions">
                                <a class="btn btn-store" href="/products/<%= product.id %>">Quero agora</a>
                                <button type="button" class="btn btn-store-secondary">Adicionar ao carrinho</button>
                            </div>
                        </div>
                    </article>
                <% }) %>
            </div>
        <% } else { %>
            <div class="empty-state">
                <i class="bi bi-emoji-neutral"></i>
                <p>Nenhum produto em destaque disponível no momento.</p>
            </div>
        <% } %>
    </div>
</section>

<section class="store-section store-section-alt" id="promocoes">
    <div class="container-xl">
        <div class="section-heading">
            <div>
                <span class="store-chip"><i class="bi bi-fire me-2"></i>Produtos em promoção</span>
                <h2>Ofertas agressivas por tempo limitado</h2>
                <p>Descontos reais com o DNA Kabum: velocidade, segurança e estoque garantido.</p>
            </div>
            <div class="section-cta">
                <button type="button" class="btn btn-store-secondary" disabled>Atualizado a cada 30min</button>
            </div>
        </div>
        <% if (sanitizedPromotions.length) { %>
            <div class="product-carousel" role="list">
                <% sanitizedPromotions.forEach((product) => { %>
                    <article class="product-card product-card-compact" role="listitem">
                        <div class="product-card-header">
                            <% if (product.tag) { %>
                                <span class="product-chip chip-<%= product.accent %>"><%= product.tag %></span>
                            <% } %>
                            <span class="product-rating" aria-label="Avaliação média de <%= product.rating %>">
                                <i class="bi bi-star-fill"></i>
                                <strong><%= product.rating.toFixed(1) %></strong>
                                <small>(<%= product.reviews %>)</small>
                            </span>
                        </div>
                        <h3 class="product-name"><%= product.name %></h3>
                        <p class="product-description"><%= product.description %></p>
                        <div class="product-card-footer">
                            <div>
                                <% if (product.originalPriceLabel) { %>
                                    <span class="price-old"><%= product.originalPriceLabel %></span>
                                <% } %>
                                <span class="price-current"><%= product.priceLabel %></span>
                                <% if (product.installmentLabel) { %>
                                    <span class="price-installments"><%= product.installmentLabel %></span>
                                <% } %>
                            </div>
                            <div class="product-meta">
                                <% if (product.shipping) { %>
                                    <span><i class="bi bi-truck"></i><%= product.shipping %></span>
                                <% } %>
                                <% if (product.availability) { %>
                                    <span><i class="bi bi-box-seam"></i><%= product.availability %></span>
                                <% } %>
                                <% if (product.loyaltyInfo) { %>
                                    <span><i class="bi bi-gift"></i><%= product.loyaltyInfo %></span>
                                <% } %>
                            </div>
                            <div class="product-actions">
                                <a class="btn btn-store" href="/products/<%= product.id %>">Comprar agora</a>
                                <button type="button" class="btn btn-store-secondary">Ver parcelamento</button>
                            </div>
                        </div>
                    </article>
                <% }) %>
            </div>
        <% } else { %>
            <div class="empty-state">
                <i class="bi bi-hourglass"></i>
                <p>As promoções serão liberadas em instantes. Volte em breve!</p>
            </div>
        <% } %>
    </div>
</section>

<section class="store-section" id="recomendados">
    <div class="container-xl">
        <div class="section-heading">
            <div>
                <span class="store-chip"><i class="bi bi-person-hearts me-2"></i>Recomendados para você</span>
                <h2>Sugestões baseadas no seu histórico de buscas</h2>
                <% if (recommendationTags.length) { %>
                    <p>
                        Encontramos oportunidades nas categorias
                        <% recommendationTags.forEach((tag, index) => { %>
                            <strong><%= tag %></strong><%= index < recommendationTags.length - 1 ? ', ' : '.' %>
                        <% }) %>
                    </p>
                <% } else { %>
                    <p>Personalize o catálogo fazendo login e navegando pelos seus segmentos favoritos.</p>
                <% } %>
            </div>
            <div class="section-cta">
                <% if (!user) { %>
                    <a href="/login" class="btn btn-store">Entrar para refinar</a>
                <% } else { %>
                    <a href="/notifications" class="btn btn-store">Ativar alertas de oferta</a>
                <% } %>
            </div>
        </div>
        <% if (sanitizedRecommended.length) { %>
            <div class="product-grid">
                <% sanitizedRecommended.forEach((product) => { %>
                    <article class="product-card product-card-balanced">
                        <div class="product-card-header">
                            <% if (product.tag) { %>
                                <span class="product-chip chip-<%= product.accent %>"><%= product.tag %></span>
                            <% } %>
                            <span class="product-rating" aria-label="Avaliação média de <%= product.rating %>">
                                <i class="bi bi-star-fill"></i>
                                <strong><%= product.rating.toFixed(1) %></strong>
                                <small>(<%= product.reviews %>)</small>
                            </span>
                        </div>
                        <h3 class="product-name"><%= product.name %></h3>
                        <p class="product-description"><%= product.description %></p>
                        <% if (product.features && product.features.length) { %>
                            <ul class="product-features">
                                <% product.features.slice(0, 3).forEach((feature) => { %>
                                    <li><i class="bi bi-check-circle-fill"></i><span><%= feature %></span></li>
                                <% }) %>
                            </ul>
                        <% } %>
                        <div class="product-card-footer">
                            <div>
                                <% if (product.originalPriceLabel) { %>
                                    <span class="price-old"><%= product.originalPriceLabel %></span>
                                <% } %>
                                <span class="price-current"><%= product.priceLabel %></span>
                                <% if (product.installmentLabel) { %>
                                    <span class="price-installments"><%= product.installmentLabel %></span>
                                <% } %>
                            </div>
                            <div class="product-meta">
                                <% if (product.shipping) { %>
                                    <span><i class="bi bi-truck"></i><%= product.shipping %></span>
                                <% } %>
                                <% if (product.availability) { %>
                                    <span><i class="bi bi-box-seam"></i><%= product.availability %></span>
                                <% } %>
                            </div>
                            <div class="product-actions">
                                <a class="btn btn-store" href="/products/<%= product.id %>">Ver detalhes</a>
                                <button type="button" class="btn btn-store-secondary">Adicionar à lista</button>
                            </div>
                        </div>
                    </article>
                <% }) %>
            </div>
        <% } else { %>
            <div class="empty-state">
                <i class="bi bi-search"></i>
                <p>Comece a explorar produtos para receber recomendações personalizadas.</p>
            </div>
        <% } %>
    </div>
</section>

<section class="store-section store-section-alt" id="catalogo">
    <div class="container-xl">
        <div class="section-heading">
            <div>
                <span class="store-chip"><i class="bi bi-grid me-2"></i>Lista geral de produtos</span>
                <h2>Catálogo completo para montar o ecossistema ideal</h2>
                <p>Combine hardware, periféricos, casa inteligente e soluções corporativas com a curadoria Kabum.</p>
            </div>
            <% if (catalogCategories.length) { %>
                <div class="category-filter" role="list">
                    <% catalogCategories.forEach((category) => { %>
                        <span class="filter-chip" role="listitem">
                            <i class="bi bi-tag"></i>
                            <%= category %>
                        </span>
                    <% }) %>
                </div>
            <% } %>
        </div>
        <% if (sanitizedCatalog.length) { %>
            <div class="catalog-grid">
                <% sanitizedCatalog.forEach((product) => { %>
                    <article class="product-card product-card-catalog" data-category="<%= product.category %>">
                        <div class="product-card-header">
                            <% if (product.tag) { %>
                                <span class="product-chip chip-<%= product.accent %>"><%= product.tag %></span>
                            <% } %>
                            <span class="product-rating" aria-label="Avaliação média de <%= product.rating %>">
                                <i class="bi bi-star-fill"></i>
                                <strong><%= product.rating.toFixed(1) %></strong>
                                <small>(<%= product.reviews %>)</small>
                            </span>
                        </div>
                        <h3 class="product-name"><%= product.name %></h3>
                        <p class="product-description"><%= product.description %></p>
                        <div class="product-card-footer">
                            <div>
                                <% if (product.originalPriceLabel) { %>
                                    <span class="price-old"><%= product.originalPriceLabel %></span>
                                <% } %>
                                <span class="price-current"><%= product.priceLabel %></span>
                                <% if (product.installmentLabel) { %>
                                    <span class="price-installments"><%= product.installmentLabel %></span>
                                <% } %>
                            </div>
                            <div class="product-meta">
                                <% if (product.shipping) { %>
                                    <span><i class="bi bi-truck"></i><%= product.shipping %></span>
                                <% } %>
                                <% if (product.availability) { %>
                                    <span><i class="bi bi-box-seam"></i><%= product.availability %></span>
                                <% } %>
                            </div>
                            <div class="product-actions">
                                <a class="btn btn-store" href="/products/<%= product.id %>">Comprar</a>
                                <button type="button" class="btn btn-store-secondary">Comparar</button>
                            </div>
                        </div>
                    </article>
                <% }) %>
            </div>
        <% } else { %>
            <div class="empty-state">
                <i class="bi bi-archive"></i>
                <p>O catálogo geral está sendo atualizado. Volte em alguns minutos.</p>
            </div>
        <% } %>
    </div>
</section>

<section class="store-trust">
    <div class="container-xl">
        <div class="trust-grid">
            <div>
                <i class="bi bi-box2-heart"></i>
                <h4>Expedição monitorada</h4>
                <p>Cadeia logística integrada com rastreio em tempo real e embalagem reforçada Kabum Shield.</p>
            </div>
            <div>
                <i class="bi bi-credit-card"></i>
                <h4>Pagamentos seguros</h4>
                <p>Conciliação antifraude, PCI Compliance e flexibilidade de parcelamento em até 12x.</p>
            </div>
            <div>
                <i class="bi bi-headset"></i>
                <h4>Atendimento especialista</h4>
                <p>Time dedicado 24/7 com especialistas em hardware, periféricos e infraestrutura corporativa.</p>
            </div>
        </div>
    </div>
</section>

<%- include('partials/footer') %>
